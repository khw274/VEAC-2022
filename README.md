# 2022년 동계 혁신공유대학 가상환경 기반 자율주행 경진대회

● 가상환경(MORAI 시뮬레이션)에서 도로주행, 장애물 및 신호등 인식 자율주행 미션 수행  
● ROS 환경에서 자율주행 알고리즘 프로그래밍  
● 3차원 가상 주행로에서 트랙 기반 자율주행 경진대회

```본선 탈락```
## 역할
● 라이다 센서를 활용한 장애물 인지 및 회피 알고리즘 설계    
● ROS 기반 교통 정보 인지 및 정차 판단 알고리즘 설계    
● 원형 교차로 통과 판단 알고리즘 설계

## 활용
PYTHON, MORAI SIM, ROS1 noetic, UBUNTU 20.04, RVIZ, WSL

## 교육
● Python 기초 교육  
● 자율주행 프로그래밍 교육 제공(ROS, MORAI 시뮬레이션 활용법, GPS 센서, 경로 추종, OpenCV 등)  

## 대회 준비
### 초기 세팅
● 노트북 용량 문제와 편하게 윈도우와 사용하기 위해 WSL에 UBUNTU 20.04 환경을 구축함.  
● 기본적으로 UBUNTU 20.04와 호환되는 ROS1 Noetic 버전을 설치함.

### 경로 설정
MORAI SIM 수동모드로 설정

path_maker 노드를 실행시켜 주어진 경로 폴더에서 파일로 저장할 차량의 위치 정보를 받아옴.  
수동으로 일정 거리 이상 이동할 때마다 위치를 기록하고 파일에 작성, 세밀하게 조작해 최대한 깔끔한 경로를 추출함.

![image](https://github.com/khw274/VEAC-2022/assets/125671828/019d9230-e1f3-47a6-8ae0-34f3928cc3e9)  

더 정확한 경로 추종을 위해 Pure Pursuit 변수값 조정 > 다음에 분석

### 미션 코드 설계
#### (속도 조정 방법)
wecar planner(메인 노드)에서 계획한 현재 속도, 각 미션을 수행할 때 필요한 적정 속도 모두 다르기 때문에 때에 따라 속도값을 조절하는 것은 필수적이다.

속도값 조정을 위해 사용한 방법을 단계별로 설명하도록 하겠다.
- 먼저 상황에 따른 속도값을 저장하기 위한 비어있는 리스트를 생성한다.
- 각 미션에서 publish 한 속도 변수들을 충분히 큰 수로 초기화한다.(999로 초기화 하였다)
- 큰 값으로 초기화 해놓은 속도들 중 사용할 속도는 작은 값으로 설정해 별도의 속도 변수에 저장한다.  ex) min_vel = min(속도 리스트)
- 미션 코드에서 정해진 기본 속도로 주행하고 싶을 땐 속도를 999로 초기화,
  특정 속도로 주행하고 싶을 땐 나머지 속도 값을 999로 초기화하고 특정 속도를 그보다 작은 값으로 설정해 주행할 수 있도록 활용하였다. 

#### (신호등 정차 미션)
신호등 미션에서는 카메라를 사용하지 않는 방법을 채택했다.

MORAI에서 정의한 메시지 유형을 포함한 패키지 morai_msgs에서 GetTrafficLightStatus 메시지를 불러왔다. 

GetTrafficLightStatus 메시지는 실시간으로 전송되는 MORAI SIM에서의 신호등 상태 정보를 포함하고 있다. 

- /GetTrafficLightStatus, /current_waypoint 토픽을 subscribe 하여 신호등 상태와 현재 차량의 waypoint 정보를 받아옴
- 변수에 신호등 상태에 따른 output 값 저장(파란불일 시 '16' 값이 나오는 것을 확인)
- MORAI SIM에서 신호등 구간을 임의로 정해 waypoint 정보 저장(측정 결과 171~172 신호등 웨이포인트), rosrun echo 명령어를 통해 /current_waypoint 토픽에서 발행된 메시지를 확인하여 측정함 
- 신호등 상태에 따른 if문 작성, 파란불이 아닐 시 속도를 0으로 지정함
- 설정한 속도를 변수에 저장하고 Publisher을 통해 메인 노드가 구독할 수 있도록 메시지 송신
<img src="https://github.com/khw274/VEAC-2022/assets/125671828/90d58a0f-d136-4eae-850a-995858a92341" width="700" height="400"/>

#### (로터리 미션)

#### (동적 장애물 미션)

#### (정적 장애물 미션)

#### (라바콘 미션)
